<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.classroom.dao.SCourseDao">

<!-- 강의관리 출결 : 학생이 듣는 특정 강의 내용 조회 -->
<select id="sStudentCourseInfo" resultType="kr.happyjob.study.classroom.dto.SCourseDto">
	SELECT a.loginID,
	       c.course_no,
	       c.course_subject,
	       c.course_name,
	       c.course_start_date,
	       c.course_end_date
	FROM tb_course c
	LEFT OUTER JOIN
	       tb_attendance a ON a.course_no = c.course_no
	WHERE a.loginID = #{loginID}
	AND a.course_no = #{pCourseNo}
	GROUP BY a.loginID, c.course_no
</select>

<!-- 강의관리 출결 : 학생 출결(출석한 횟수) -->
<select id="sAttendanceDays" resultType="int">
	SELECT count(*)
	FROM tb_attendance a
	LEFT OUTER JOIN
	     tb_userinfo ui ON ui.loginID = a.loginID
	LEFT OUTER JOIN
	     tb_course c ON c.course_no = a.course_no
	WHERE a.loginID = #{loginID}
	AND a.course_no = #{pCourseNo}
	AND a.attendance_status = "출석"
</select>

<!-- 강의관리 출결 : 학생 출결(결석한 횟수) -->
<select id="sAbsenceDays" resultType="int">
	SELECT count(*)
	FROM tb_attendance a
	LEFT OUTER JOIN
	     tb_userinfo ui ON ui.loginID = a.loginID
	LEFT OUTER JOIN
	     tb_course c ON c.course_no = a.course_no
	WHERE a.loginID = #{loginID}
	AND a.course_no = #{pCourseNo}
	AND a.attendance_status = "결석"
</select>

<!-- 강의관리 출결 : 학생 출결(지각, 결석한 것만) -->
<select id="sAttendanceNotes" resultType="kr.happyjob.study.classroom.dto.SCourseDto">
	SELECT ui.loginID,
	       a.attendance_no,
	       a.course_no,
	       DATE_FORMAT(a.attendance_date , '%Y-%m-%d') as attendance_date,
	       a.attendance_status,
	       c.course_subject,
	       c.course_name,
	       c.course_start_date,
	       c.course_end_date
	FROM tb_attendance a
	LEFT OUTER JOIN
	     tb_userinfo ui ON ui.loginID = a.loginID
	LEFT OUTER JOIN
	     tb_course c ON c.course_no = a.course_no
	WHERE a.loginID = #{loginID}
	AND a.course_no = #{pCourseNo}
	AND (a.attendance_status = "지각" OR a.attendance_status = "결석")
	ORDER BY attendance_date ASC
</select>

</mapper>